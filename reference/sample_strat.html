<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Stratified sampling — sample_strat • sgsR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Stratified sampling — sample_strat"><meta name="description" content="Sampling based on a stratified raster."><meta property="og:description" content="Sampling based on a stratified raster."><meta property="og:image" content="/reference/figures/logo.png"><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script><script defer data-domain="pkgdown.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sgsR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/sgsR.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/calculating.html">Calculating</a></li>
    <li><a class="dropdown-item" href="../articles/sampling.html">Sampling</a></li>
    <li><a class="dropdown-item" href="../articles/stratification.html">Stratification</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tgoodbody/sgsR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Stratified sampling</h1>
      <small class="dont-index">Source: <a href="https://github.com/tgoodbody/sgsR/blob/main/R/sample_strat.R" class="external-link"><code>R/sample_strat.R</code></a></small>
      <div class="d-none name"><code>sample_strat.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Sampling based on a stratified raster.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sample_strat</span><span class="op">(</span></span>
<span>  <span class="va">sraster</span>,</span>
<span>  <span class="va">nSamp</span>,</span>
<span>  allocation <span class="op">=</span> <span class="st">"prop"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"Queinnec"</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  force <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  mraster <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mindist <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  existing <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  include <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  remove <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  access <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  buff_inner <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  buff_outer <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  wrow <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  wcol <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  details <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  filename <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-sraster">sraster<a class="anchor" aria-label="anchor" href="#arg-sraster"></a></dt>
<dd><p>spatRaster. Stratification raster to be used for sampling.</p></dd>


<dt id="arg-nsamp">nSamp<a class="anchor" aria-label="anchor" href="#arg-nsamp"></a></dt>
<dd><p>Numeric. Number of desired samples. <code>existing</code>, <code>include</code> and <code>force</code> influence this value.</p></dd>


<dt id="arg-allocation">allocation<a class="anchor" aria-label="anchor" href="#arg-allocation"></a></dt>
<dd><p>Character. Allocation algorithm to be used. Either <code>prop</code> (default) for proportional allocation,
<code>optim</code> for optimal allocation (equal sampling cost), <code>equal</code> for equal number of samples (defined by <code>nSamp</code>)
for each strata, or <code>"manual"</code> for user defined strata weights defined using <code>weights</code>.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Character. Sampling design approach <code>"Queinnec"</code> (default) or <code>"random"</code>. <code>"Queinnec"</code> method is
described in notes below. <code>"random"</code> performs traditional stratified random sampling where probability to sample each
cell within each stratum is equal assuming default parameters for <code>mindist</code>. <code>existing, include, remove</code> are ignored when <code>method = "random"</code>.</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>Numeric. Only applicable when <code>allocation = "manual"</code>. Vector of weights where <code>sum(weights) == 1</code>. Vector length
must be equal to the number of unique strata where the first numeric value corresponds to stratum 1, second stratum 2 etc.</p></dd>


<dt id="arg-force">force<a class="anchor" aria-label="anchor" href="#arg-force"></a></dt>
<dd><p>Logical. <code>Default = FALSE</code> - force <code>nSamp</code> to be exactly the user defined value
in cases where <code>nSamp</code> and <code>sraster</code> strata count are not equally divisible. Additional samples often need to be allocated or removed
based on rounding differences resulting from proportional differences between <code>nSamp</code> and strata coverages in <code>sraster</code>.
In these instances samples are either added to strata with the lowest number of samples or are removed from strata with the highest number of samples.
Has no effect when <code>existing</code> is provided.</p></dd>


<dt id="arg-mraster">mraster<a class="anchor" aria-label="anchor" href="#arg-mraster"></a></dt>
<dd><p>spatRaster. ALS metric raster. Required when <code>allocation = optim</code>.</p></dd>


<dt id="arg-mindist">mindist<a class="anchor" aria-label="anchor" href="#arg-mindist"></a></dt>
<dd><p>Numeric. Minimum allowable distance between selected
samples. <code>Default = NULL</code>.</p></dd>


<dt id="arg-existing">existing<a class="anchor" aria-label="anchor" href="#arg-existing"></a></dt>
<dd><p>sf 'POINT' or data.frame.  Existing plot network.</p></dd>


<dt id="arg-include">include<a class="anchor" aria-label="anchor" href="#arg-include"></a></dt>
<dd><p>Logical. If <code>TRUE</code> include <code>existing</code> plots in <code>nSamp</code> total.</p></dd>


<dt id="arg-remove">remove<a class="anchor" aria-label="anchor" href="#arg-remove"></a></dt>
<dd><p>Logical. If <code>TRUE</code> randomly remove samples from over represented strata to meet allocated sample numbers.
Used only when <code>existing</code> and <code>include</code> are both <code>TRUE</code>.</p></dd>


<dt id="arg-access">access<a class="anchor" aria-label="anchor" href="#arg-access"></a></dt>
<dd><p>sf 'LINESTRING' or 'MULTILINESTRING'. Access network.</p></dd>


<dt id="arg-buff-inner">buff_inner<a class="anchor" aria-label="anchor" href="#arg-buff-inner"></a></dt>
<dd><p>Numeric. Inner buffer boundary specifying distance
from access where plots cannot be sampled.</p></dd>


<dt id="arg-buff-outer">buff_outer<a class="anchor" aria-label="anchor" href="#arg-buff-outer"></a></dt>
<dd><p>Numeric. Outer buffer boundary specifying distance
from access where plots can be sampled.</p></dd>


<dt id="arg-wrow">wrow<a class="anchor" aria-label="anchor" href="#arg-wrow"></a></dt>
<dd><p>Numeric. Number of row in the focal window (<code>default = 3</code>).</p></dd>


<dt id="arg-wcol">wcol<a class="anchor" aria-label="anchor" href="#arg-wcol"></a></dt>
<dd><p>Numeric. Number of columns in the focal window (<code>default = 3</code>).</p></dd>


<dt id="arg-plot">plot<a class="anchor" aria-label="anchor" href="#arg-plot"></a></dt>
<dd><p>Logical. Plots samples of type `existing` (if provided; croses) and `new` (circles) along with <code>sraster</code>.</p></dd>


<dt id="arg-details">details<a class="anchor" aria-label="anchor" href="#arg-details"></a></dt>
<dd><p>Logical. If <code>FALSE</code> (default) output is sf object of
stratified samples. If <code>TRUE</code> return a list
where <code>$details</code> additional sampling information and <code>$raster</code>
is an sf object of stratified samples.</p></dd>


<dt id="arg-filename">filename<a class="anchor" aria-label="anchor" href="#arg-filename"></a></dt>
<dd><p>Character. Path to write output samples.</p></dd>


<dt id="arg-overwrite">overwrite<a class="anchor" aria-label="anchor" href="#arg-overwrite"></a></dt>
<dd><p>Logical. Choice to overwrite existing <code>filename</code> if it exists.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An sf object with <code>nSamp</code> stratified samples.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>The sampling is performed in 2 stages when <code>method = "Queinnec"</code>:</p><ol><li><p><code>Rule 1</code> - Sample within grouped stratum pixels defined within the
<code>wrow, wcol</code> parameters</p></li>
<li><p><code>Rule 2</code> - If no samples exist to satisfy Rule 1
 individual stratum pixels are sampled.</p>
<p>The rule applied to allocate each sample is defined in the <code>rule</code> attribute of output samples.</p></li>
</ol><p><code>existing</code> may contain samples that fall in <code>sraster</code> cells that are `NA`. If this occurs and <code>include = TRUE</code>, `NA` samples
are separated during sampling and re-appended at the end of the sampling process.</p>
<p>If the <code>sraster</code> provided contains factor values, the algorithm will automatically convert these into the numeric factor levels and
perform sampling using those values. The categories (factor values) will be extracted and appended to the algorithm output as the `category` attribute.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Queinnec, M., White, J. C., &amp; Coops, N. C. (2021).
Comparing airborne and spaceborne photon-counting LiDAR canopy
structural estimates across different boreal forest types.
Remote Sensing of Environment, 262 (August 2020), 112510.
https://doi.org/10.1016/j.rse.2021.112510</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other sample functions:
<code><a href="sample_ahels.html">sample_ahels</a>()</code>,
<code><a href="sample_balanced.html">sample_balanced</a>()</code>,
<code><a href="sample_clhs.html">sample_clhs</a>()</code>,
<code><a href="sample_existing.html">sample_existing</a>()</code>,
<code><a href="sample_nc.html">sample_nc</a>()</code>,
<code><a href="sample_srs.html">sample_srs</a>()</code>,
<code><a href="sample_sys_strat.html">sample_sys_strat</a>()</code>,
<code><a href="sample_systematic.html">sample_systematic</a>()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Tristan R.H. Goodbody &amp; Martin Queinnec</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#--- Load raster and access files ---#</span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"sraster.tif"</span>, package <span class="op">=</span> <span class="st">"sgsR"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sr</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#--- perform stratified sampling random sampling ---#</span></span></span>
<span class="r-in"><span><span class="va">sraster</span> <span class="op">&lt;-</span> <span class="fu">sample_strat</span><span class="op">(</span></span></span>
<span class="r-in"><span>  sraster <span class="op">=</span> <span class="va">sr</span>,</span></span>
<span class="r-in"><span>  nSamp <span class="op">=</span> <span class="fl">50</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using 'Queinnec' sampling method.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Implementing proportional allocation of samples.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> nSamp of 50 is not perfectly divisible based on strata distribution. nSamp of 51 will be returned. Use 'force = TRUE' to brute force to 50.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Processing strata : 1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Processing strata : 2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Processing strata : 3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Processing strata : 4</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://scholar.google.ca/citations?user=C_qdYDsAAAAJ&amp;hl=en" class="external-link">Tristan RH Goodbody</a>, <a href="https://forestry.ubc.ca/faculty-profile/nicholas-coops/" class="external-link">Nicholas C Coops</a>, <a href="https://www.researchgate.net/profile/Martin-Queinnec" class="external-link">Martin Queinnec</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

